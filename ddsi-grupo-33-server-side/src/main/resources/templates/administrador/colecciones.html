<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Colecciones | Panel de Administración MetaMapa</title>
  <link
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
          crossorigin="anonymous"
  />
  <link
          rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
  />
</head>
<body>
<nav class="navbar navbar-dark bg-dark fixed-top">
  <div class="container-fluid">
    <a class="navbar-brand" href="/admin">Administrador</a>
    <button
            class="navbar-toggler d-md-none"
            type="button"
            data-bs-toggle="offcanvas"
            data-bs-target="#sidebarOffcanvas"
            aria-controls="sidebarOffcanvas"
            aria-label="Toggle navigation"
    >
      <span class="navbar-toggler-icon"></span>
    </button>
  </div>
</nav>

<div class="container-fluid">
  <div class="row flex-nowrap">
    <div
            class="col-xl-2 col-3 bg-dark vh-100 top-0 start-0 d-md-block d-none"
    >
      <div class="d-flex flex-column flex-shrink-0 p-3 pt-5 text-white-50">
        <ul class="nav nav-pills flex-column mb-auto mt-4">
          <li class="nav-item">
            <a href="/admin" class="nav-link text-white">
              <i class="bi bi-grid-fill me-2"></i> Resumen
            </a>
          </li>
          <hr />
          <li>
            <a
                    href="/administrador/hechos.html"
                    class="nav-link text-white"
            >
              <i class="bi bi-geo-alt-fill me-2"></i> Hechos
            </a>
          </li>
          <li class="nav-item">
            <a
                    href="/admin/colecciones"
                    class="nav-link active"
                    aria-current="page"
            >
              <i class="bi bi-folder-fill me-2"></i> Colecciones
            </a>
          </li>
          <li>
            <a
                    href="/administrador/solicitudes.html"
                    class="nav-link text-white"
            >
              <i class="bi bi-envelope-fill me-2"></i> Solicitudes
            </a>
          </li>
          <li>
            <a
                    href="/administrador/fuentes.html"
                    class="nav-link text-white"
            >
              <i class="bi bi-database-fill me-2"></i> Fuentes
            </a>
          </li>
          <li>
            <a
                    href="/administrador/usuarios.html"
                    class="nav-link text-white"
            >
              <i class="bi bi-people-fill me-2"></i> Usuarios
            </a>
          </li>
        </ul>
      </div>
    </div>

    <div
            class="offcanvas offcanvas-start bg-dark text-white"
            tabindex="-1"
            id="sidebarOffcanvas"
            aria-labelledby="sidebarOffcanvasLabel"
    >
      <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="sidebarOffcanvasLabel">Menú</h5>
        <button
                type="button"
                class="btn-close text-reset"
                data-bs-dismiss="offcanvas"
                aria-label="Close"
        ></button>
      </div>
      <div class="offcanvas-body">
        <ul class="nav nav-pills flex-column mb-auto">
          <li class="nav-item">
            <a href="/admin" class="nav-link text-white">
              <i class="bi bi-grid-fill me-2"></i> Resumen
            </a>
          </li>
          <hr />
          <li>
            <a
                    href="/administrador/hechos.html"
                    class="nav-link text-white"
            >
              <i class="bi bi-geo-alt-fill me-2"></i> Hechos
            </a>
          </li>
          <li>
            <a
                    href="/admin/colecciones"
                    class="nav-link active"
                    aria-current="page"
            >
              <i class="bi bi-folder-fill me-2"></i> Colecciones
            </a>
          </li>
          <li>
            <a
                    href="/administrador/solicitudes.html"
                    class="nav-link text-white"
            >
              <i class="bi bi-envelope-fill me-2"></i> Solicitudes
            </a>
          </li>
          <li>
            <a
                    href="/administrador/fuentes.html"
                    class="nav-link text-white"
            >
              <i class="bi bi-database-fill me-2"></i> Fuentes
            </a>
          </li>
          <li>
            <a
                    href="/administrador/usuarios.html"
                    class="nav-link text-white"
            >
              <i class="bi bi-people-fill me-2"></i> Usuarios
            </a>
          </li>
        </ul>
      </div>
    </div>

    <main class="col-12 col-md-9 col-xl-10 px-md-4 pt-5">
      <div
              class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom"
      >
        <h1 class="h2">Gestión de Colecciones</h1>
        <div class="btn-toolbar mb-2 mb-md-0">
          <button
                  type="button"
                  class="btn btn-primary"
                  data-bs-toggle="modal"
                  data-bs-target="#createCollectionModal"
          >
            <i class="bi bi-plus-circle me-2"></i> Crear Nueva Colección
          </button>
        </div>
      </div>

      <div class="table-responsive d-none d-md-block">
        <table class="table table-striped table-sm">
          <thead>
          <tr>
            <th scope="col">ID</th>
            <th scope="col">Nombre</th>
            <th scope="col">Descripción</th>
            <th scope="col">Algoritmo de Consenso</th>
            <th scope="col">Hechos</th>
            <th scope="col">Fecha</th>
            <th scope="col">Acciones</th>
          </tr>
          </thead>
          <tbody>
          <tr th:each="coleccion : ${colecciones}">
            <td th:text="${coleccion.id}"></td>
            <td th:text="${coleccion.nombre}"></td>
            <td th:text="${coleccion.descripcion} + '.'"></td>
            <td th:text="${coleccion.algoritmoDeConsenso}"></td>
            <td th:text="${coleccion.totalHechos}"></td>
            <td th:text="${#dates.format(coleccion.fecha, 'dd MMM yyyy')}"></td>
            <td>
              <button
                      type="button"
                      class="btn btn-sm btn-info me-1 text-white"
                      data-bs-toggle="modal"
                      data-bs-target="#editCollectionModal"
                      th:data-id="${coleccion.id}"
                      th:data-nombre="${coleccion.nombre}"
                      th:data-descripcion="${coleccion.descripcion}"
                      th:data-consenso="${coleccion.algoritmoDeConsenso}"
              >
                <i class="bi bi-pencil-square"></i> Editar
              </button>
              <button
                      type="button"
                      class="btn btn-sm btn-danger"
                      data-bs-toggle="modal"
                      data-bs-target="#deleteCollectionModal"
              >
                <i class="bi bi-trash"></i> Eliminar
              </button>
            </td>
          </tr>
          </tbody>
        </table>
      </div>

      <div class="d-block d-md-none">
        <div class="card mb-3" th:each="coleccion : ${colecciones}">
          <div class="card-body">
            <h5 class="card-title fw-bold" th:text="${coleccion.nombre}"></h5>
            <p class="card-text">
              <small class="fw-bold">ID:</small>
              <small th:text="${coleccion.id}">1</small>
            </p>
            <p class="card-text">
              <small class="fw-bold">Descripción:</small>
              <small th:text="${coleccion.descripcion} + '.'"></small>
            </p>
            <p class="card-text">
              <small class="fw-bold">Consenso:</small>
              <small th:text="${coleccion.algoritmoDeConsenso}"></small>
            </p>
            <p class="card-text">
              <small class="fw-bold">Hechos:</small>
              <small th:text="${coleccion.totalHechos}"></small>
            </p>
            <p class="card-text">
              <small class="fw-bold">Fecha:</small>
              <small th:text="${#dates.format(coleccion.fecha, 'dd MMM yyyy')}"></small>
            </p>
            <div class="mt-3">
              <button
                      type="button"
                      class="btn btn-sm btn-info me-1 text-white"
                      data-bs-toggle="modal"
                      data-bs-target="#editCollectionModal"
                      th:data-id="${coleccion.id}"
                      th:data-nombre="${coleccion.nombre}"
                      th:data-descripcion="${coleccion.descripcion}"
                      th:data-consenso="${coleccion.algoritmoDeConsenso}"
              >
                <i class="bi bi-pencil-square"></i> Editar
              </button>
              <button
                      type="button"
                      class="btn btn-sm btn-danger"
                      data-bs-toggle="modal"
                      data-bs-target="#deleteCollectionModal"
              >
                <i class="bi bi-trash"></i> Eliminar
              </button>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>
</div>

<div
        class="modal fade"
        id="createCollectionModal"
        tabindex="-1"
        aria-labelledby="createCollectionModalLabel"
        aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="createCollectionModalLabel">
          Crear Nueva Colección
        </h5>
        <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <form>
          <div class="mb-3">
            <label for="collectionName" class="form-label">Nombre</label>
            <input
                    type="text"
                    class="form-control"
                    id="collectionName"
                    required
            />
          </div>
          <div class="mb-3">
            <label for="collectionDescription" class="form-label"
            >Descripción</label
            >
            <textarea
                    class="form-control"
                    id="collectionDescription"
                    rows="3"
            ></textarea>
          </div>
          <div class="mb-3">
            <label for="consensusAlgorithm" class="form-label"
            >Algoritmo de Consenso</label
            >
            <select class="form-select" id="consensusAlgorithm" required>
              <option selected disabled value="">Seleccionar...</option>
              <option>Mayoría simple</option>
              <option>Aprobar hechos verificados</option>
              <option>Voto ponderado por usuario</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
        >
          Cancelar
        </button>
        <button type="button" class="btn btn-primary">Crear</button>
      </div>
    </div>
  </div>
</div>

<div
        class="modal fade"
        id="editCollectionModal"
        tabindex="-1"
        aria-labelledby="editCollectionModalLabel"
        aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editCollectionModalLabel">
          Editar Colección
        </h5>
        <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <form>
          <div class="mb-3">
            <label for="editCollectionName" class="form-label"
            >Nombre</label
            >
            <input
                    type="text"
                    class="form-control"
                    id="editCollectionName"
                    value="Incendios Forestales"
                    required
            />
          </div>
          <div class="mb-3">
            <label for="editCollectionDescription" class="form-label"
            >Descripción</label
            >
            <textarea
                    class="form-control"
                    id="editCollectionDescription"
                    rows="3"
            >
Geolocalización de incendios a nivel nacional.
                        </textarea>
          </div>
          <div class="mb-3">
            <label for="editConsensusAlgorithm" class="form-label"
            >Algoritmo de Consenso</label
            >
            <select
                    class="form-select"
                    id="editConsensusAlgorithm"
                    required
            >
              <option selected>Mayoría simple</option>
              <option>Aprobar hechos verificados</option>
              <option>Voto ponderado por usuario</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
        >
          Cancelar
        </button>
        <button type="button" class="btn btn-info text-white">
          Guardar Cambios
        </button>
      </div>
    </div>
  </div>
</div>

<div
        class="modal fade"
        id="deleteCollectionModal"
        tabindex="-1"
        aria-labelledby="deleteCollectionModalLabel"
        aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteCollectionModalLabel">
          Confirmar Eliminación
        </h5>
        <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <p>
          ¿Estás seguro de que querés eliminar la colección seleccionada?
          Esta acción no se puede deshacer.
        </p>
      </div>
      <div class="modal-footer">
        <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
        >
          Cancelar
        </button>
        <button type="button" class="btn btn-danger">Eliminar</button>
      </div>
    </div>
  </div>
</div>
<script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
        crossorigin="anonymous"
></script>

<script>
  const editModal = document.getElementById('editCollectionModal');

  // Escucha el evento 'show.bs.modal' cuando el modal está a punto de abrirse
  editModal.addEventListener('show.bs.modal', event => {
    // Obtiene el botón que activó el modal (el botón "Editar")
    const button = event.relatedTarget;

    // 1. Obtiene los valores de los atributos data-* del botón
    const id = button.getAttribute('data-id');
    const nombre = button.getAttribute('data-nombre');
    const descripcion = button.getAttribute('data-descripcion');
    const consenso = button.getAttribute('data-consenso');

    // 2. Encuentra los campos del formulario dentro del modal
    const modalTitle = editModal.querySelector('.modal-title');
    const inputName = editModal.querySelector('#editCollectionName');
    const inputDescription = editModal.querySelector('#editCollectionDescription');
    const selectConsensus = editModal.querySelector('#editConsensusAlgorithm');

    // Asumiendo que quieres un campo para el ID, aunque no lo pediste,
    // esto es vital si quieres enviar la edición al backend.
    // Si no existe, puedes crearlo como un input hidden.
    let inputId = editModal.querySelector('#editCollectionId');
    if (!inputId) {
      // Crea un campo oculto para almacenar el ID
      inputId = document.createElement('input');
      inputId.type = 'hidden';
      inputId.id = 'editCollectionId';
      inputId.name = 'id';
      // Insértalo en algún lugar del formulario, por ejemplo, al inicio del modal body.
      editModal.querySelector('.modal-body form').prepend(inputId);
    }

    // 3. Rellena los campos del formulario con los nuevos valores

    // Rellena el input oculto con el ID
    inputId.value = id;

    // Rellena el título del modal
    modalTitle.textContent = `Editar Colección #${id} (${nombre})`;

    // Rellena los campos de Nombre y Descripción
    inputName.value = nombre;
    inputDescription.value = descripcion;

    // Rellena el select de Algoritmo de Consenso
    // Busca la opción cuyo texto coincida con el valor de 'consenso'
    for (let i = 0; i < selectConsensus.options.length; i++) {
      // Usa .trim() para evitar problemas con espacios extra
      if (selectConsensus.options[i].text.trim() === consenso.trim()) {
        selectConsensus.selectedIndex = i;
        break;
      }
    }
  });
</script>
</body>
</html>